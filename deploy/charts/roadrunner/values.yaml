replicaCount: 1

image:
  repository: ghcr.io/roadrunner-server/rr-php-worker-example
  tag: "latest"
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

command:
  - rr
args:
  - serve
  - -c
  - /etc/rr/.rr.yaml
  - -w
  - /app

roadrunner:
  # If set, chart will mount this existing ConfigMap instead of creating one.
  existingConfigMap: ""
  # Rendered through Helm tpl(), so this block can use .Values references.
  config: |
    version: "3"

    rpc:
      listen: tcp://127.0.0.1:{{ .Values.ports.rpc.containerPort }}

    server:
      # Replace with your PHP worker command.
      command: "php /app/worker.php"
      relay: pipes

    http:
      address: 0.0.0.0:{{ .Values.ports.http.containerPort }}

    logs:
      mode: production
      level: info
      encoding: json
      output: ["stdout"]
      err_output: ["stderr"]

    status:
      address: 0.0.0.0:{{ .Values.ports.status.containerPort }}

    {{- if .Values.ports.metrics.enabled }}
    metrics:
      address: 0.0.0.0:{{ .Values.ports.metrics.containerPort }}
    {{- end }}

    endure:
      log_level: error
      grace_period: {{ .Values.endure.gracePeriod }}

extraEnv: []
extraEnvFrom: []

service:
  type: ClusterIP
  annotations: {}

ports:
  http:
    enabled: true
    service: true
    containerPort: 8080
    servicePort: 80
    protocol: TCP
  grpc:
    enabled: false
    service: false
    containerPort: 9001
    servicePort: 9001
    protocol: TCP
  metrics:
    enabled: false
    service: false
    containerPort: 2112
    servicePort: 2112
    protocol: TCP
  status:
    enabled: true
    service: false
    containerPort: 2114
    servicePort: 2114
    protocol: TCP
  rpc:
    enabled: false
    service: false
    containerPort: 6001
    servicePort: 6001
    protocol: TCP

probes:
  readiness:
    enabled: true
    path: /ready?plugin=http
    port: status
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 2
    successThreshold: 1
    failureThreshold: 3
  liveness:
    enabled: true
    path: /health?plugin=http
    port: status
    initialDelaySeconds: 15
    periodSeconds: 10
    timeoutSeconds: 2
    successThreshold: 1
    failureThreshold: 3

terminationGracePeriodSeconds: 30
endure:
  gracePeriod: 30s

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}
securityContext: {}

resources: {}

nodeSelector: {}
tolerations: []
affinity: {}
priorityClassName: ""
topologySpreadConstraints: []

gateway:
  enabled: true
  create: true
  name: ""
  namespace: ""
  className: cilium
  annotations: {}
  listeners:
    http:
      enabled: true
      name: http
      port: 80
      hostname: roadrunner.local
      allowedRoutesNamespacesFrom: Same
    https:
      enabled: false
      name: https
      port: 443
      hostname: roadrunner.local
      allowedRoutesNamespacesFrom: Same
      tls:
        mode: Terminate
        certificateRefs: []
  route:
    enabled: true
    name: ""
    annotations: {}
    hostnames:
      - roadrunner.local
    pathPrefix: /
    parentRefs: []

ingress:
  # Optional compatibility mode. Gateway API is the default exposure model.
  enabled: false
  className: ""
  annotations: {}
  backendPortName: http
  hosts:
    - host: roadrunner.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

monitoring:
  serviceMonitor:
    enabled: false
    namespace: ""
    labels: {}
    annotations: {}
    interval: 30s
    scrapeTimeout: 10s
    path: /metrics
    honorLabels: false
    relabelings: []
    metricRelabelings: []

pdb:
  enabled: false
  minAvailable: 1
  maxUnavailable: null

hpa:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: null
